/*
 * Generated with Netbeans 7.2 GUI Builder
 * 
 * @author barn
 * @version 20121010
 * 
 */
package ui;

import filegen.CppFileGenerator;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import javax.swing.JOptionPane;
/**
 * This class represents the gui of the program.
 * @author Barn
 * @version 20121009
 */
public class UIFrame extends javax.swing.JFrame {

    // INSTANCE VARS //////////////////////////////////////////////////////////////////////////////
    
	/**
	 * The file generator instance.
	 */
    private CppFileGenerator filegen;
    
	/**
	 * The path of the config file.
	 */
    private String configFile;
	
	/**
	 * The path of the log file.
	 */
    private String logFile;
    
    // CONSTRUCTOR ////////////////////////////////////////////////////////////////////////////////
    
    /**
     * Creates new form myJFrame
     */
    public UIFrame( String configFile, String logFile) {
        
        this.configFile = configFile;
        this.logFile = logFile;
        
        initComponents();
        
        // maximizes the window
        setExtendedState(MAXIMIZED_BOTH);
		
        if( ! new File(configFile).exists()){

                JOptionPane.showMessageDialog(
						null,
                        "The Config file \"" + configFile + "\" could not be found.\n\n"
                        + "Cpp Filegen UI creates it." , "Config file not found.", JOptionPane.OK_OPTION);
                
                writeFile(
                        configFile, 
                        "# Die Files.\n\n\n" +
                        "# So Standard setup Kram. Muss man eigentlich nur selten Ã¤ndern.\n" +
                        "# Die Reihenfolge der ganzen Statements ist egal.\n\n" +
                        "author: <author>\n" +
                        "namespace: <namespace>\n" +
                        "HPath:	<hpath>\n" +
                        "CppPath: <cpppath>\n" +
                        "HTemplate: Template.h\n" +
                        "HppTemplate: Template.hpp\n" +
                        "CppTemplate: Template.cpp");
        }
        
        txtConfig.setText( readFile(configFile));
        lblConfig.setText( "Config File: " + configFile);
        
        lblLog.setText( "Log File: " + logFile);
        
        filegen = new CppFileGenerator( logFile);
        filegen.parseConfigFile( configFile);
        filegen.getLogger().closeStream();
    }

    // PRIVATE HELPERS //////////////////////////////////////////////////////////////////////////// 
    
    /**
     * Opens a folder or a file in its native program.
     * @param path
     * The path to the file/folder as a <i>String</i>.
     */
    private void openPath( String path)
    {
            String slashbackpath = path.replaceAll("/", "\\\\");
        
            try{
                
                new ProcessBuilder("explorer.exe ", slashbackpath).start();
                                  
            }catch( Exception e){
                JOptionPane.showMessageDialog(
                        null,
                        "The path \"" + slashbackpath + "\" could not be opened.\n" + 
                        e.getMessage() + "\n" + e.getStackTrace() + "\n",
                        "Error - Barns Cpp Filegen.",
                        JOptionPane.OK_OPTION);
            }
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlSplit = new javax.swing.JSplitPane();
        pnlLog = new javax.swing.JPanel();
        lblLog = new javax.swing.JLabel();
        pnlScrollLog = new javax.swing.JScrollPane();
        txtLog = new javax.swing.JTextArea();
        pnlConfig = new javax.swing.JPanel();
        lblConfig = new javax.swing.JLabel();
        pnlScrollConfig = new javax.swing.JScrollPane();
        txtConfig = new javax.swing.JTextArea();
        btnOpenHPath = new javax.swing.JButton();
        btnOpenCppPath = new javax.swing.JButton();
        btnGo = new javax.swing.JButton();
        btnOpenHTemplate = new javax.swing.JButton();
        btnOpenHppTemplate = new javax.swing.JButton();
        btnOpenCppTemplate = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Barns Cpp Filegen GUI");
        setName("frmFrame"); // NOI18N
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
        });

        pnlSplit.setDividerLocation(300);

        lblLog.setText("Log File");

        txtLog.setColumns(20);
        txtLog.setRows(5);
        pnlScrollLog.setViewportView(txtLog);

        javax.swing.GroupLayout pnlLogLayout = new javax.swing.GroupLayout(pnlLog);
        pnlLog.setLayout(pnlLogLayout);
        pnlLogLayout.setHorizontalGroup(
            pnlLogLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlScrollLog, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
            .addGroup(pnlLogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblLog)
                .addContainerGap(626, Short.MAX_VALUE))
        );
        pnlLogLayout.setVerticalGroup(
            pnlLogLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlLogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblLog)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnlScrollLog, javax.swing.GroupLayout.DEFAULT_SIZE, 464, Short.MAX_VALUE))
        );

        pnlSplit.setRightComponent(pnlLog);

        lblConfig.setText("Config File");

        txtConfig.setColumns(20);
        txtConfig.setRows(5);
        txtConfig.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                btnOpenHppTemplateKeyPressed(evt);
            }
        });
        pnlScrollConfig.setViewportView(txtConfig);

        javax.swing.GroupLayout pnlConfigLayout = new javax.swing.GroupLayout(pnlConfig);
        pnlConfig.setLayout(pnlConfigLayout);
        pnlConfigLayout.setHorizontalGroup(
            pnlConfigLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlConfigLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblConfig)
                .addContainerGap())
            .addComponent(pnlScrollConfig, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 299, Short.MAX_VALUE)
        );
        pnlConfigLayout.setVerticalGroup(
            pnlConfigLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlConfigLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblConfig)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnlScrollConfig, javax.swing.GroupLayout.DEFAULT_SIZE, 464, Short.MAX_VALUE))
        );

        pnlSplit.setLeftComponent(pnlConfig);

        btnOpenHPath.setMnemonic('h');
        btnOpenHPath.setText("Open HPath");
        btnOpenHPath.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenHPathActionPerformed(evt);
            }
        });

        btnOpenCppPath.setMnemonic('c');
        btnOpenCppPath.setText("Open CppPath");
        btnOpenCppPath.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenCppPathActionPerformed(evt);
            }
        });

        btnGo.setMnemonic('G');
        btnGo.setText("Go");
        btnGo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGoActionPerformed(evt);
            }
        });

        btnOpenHTemplate.setMnemonic('t');
        btnOpenHTemplate.setText("Open H Template");
        btnOpenHTemplate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenHTemplateActionPerformed(evt);
            }
        });

        btnOpenHppTemplate.setMnemonic('e');
        btnOpenHppTemplate.setText("Open Hpp Template");
        btnOpenHppTemplate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenHppTemplateActionPerformed(evt);
            }
        });

        btnOpenCppTemplate.setMnemonic('m');
        btnOpenCppTemplate.setText("Open Cpp Template");
        btnOpenCppTemplate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenCppTemplateActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlSplit)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(btnOpenHTemplate, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnOpenHppTemplate))
                    .addComponent(btnOpenHPath, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(59, 59, 59)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btnOpenCppTemplate)
                    .addComponent(btnOpenCppPath, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnGo, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnlSplit)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(btnOpenHPath)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnOpenHppTemplate)
                            .addComponent(btnOpenHTemplate)))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(btnOpenCppPath)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnOpenCppTemplate))
                    .addComponent(btnGo, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnGoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGoActionPerformed
        
        writeFile(configFile, txtConfig.getText());
        
        filegen.getLogger().clearLogFile();
        filegen.process( configFile);
        
        txtLog.setText( this.readFile(logFile));
    }//GEN-LAST:event_btnGoActionPerformed

    private void btnOpenCppPathActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenCppPathActionPerformed

        openPath( filegen.getCppPath());       
    }//GEN-LAST:event_btnOpenCppPathActionPerformed

    private void btnOpenHPathActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenHPathActionPerformed
        
        openPath( filegen.getHPath());
    }//GEN-LAST:event_btnOpenHPathActionPerformed

    private void btnOpenHTemplateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenHTemplateActionPerformed
        
        openPath( filegen.getHTemplateFilePath());
    }//GEN-LAST:event_btnOpenHTemplateActionPerformed

    private void btnOpenHppTemplateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenHppTemplateActionPerformed
        
        openPath( filegen.getHppTemplateFilePath());
    }//GEN-LAST:event_btnOpenHppTemplateActionPerformed

    private void btnOpenCppTemplateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenCppTemplateActionPerformed
        
        openPath( filegen.getCppTemplateFilePath());
    }//GEN-LAST:event_btnOpenCppTemplateActionPerformed

    private void btnOpenHppTemplateKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_btnOpenHppTemplateKeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnOpenHppTemplateKeyPressed

    private void formWindowActivated(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowActivated
        // set splitter in the middle
		int loc = pnlSplit.getDividerLocation();
		loc = (int)((pnlSplit.getBounds().getWidth()-pnlSplit.getDividerSize())/2);
		pnlSplit.setDividerLocation(loc);
    }//GEN-LAST:event_formWindowActivated

        /**
	 * Reads a file and returns it as a String.
	 * @param filename
	 * The file to be read.
	 * @return
	 * A <i>String</i>.
	 */
	private String readFile( String filename)
	{
		String ret = new String();
		
		try{
                BufferedReader reader = new BufferedReader( new FileReader( filename));
                String line = reader.readLine();
                while(line != null){
                        ret = ret + line + "\n";
                        
                        line = reader.readLine();
                }
                
                reader.close();
			
		}catch (Exception e){
                        JOptionPane.showMessageDialog(
                                null,
                                "File \"" + configFile + "\" could not be read.\n"
                                + "Program quits." , "Error - Barns Cpp Filegen.", JOptionPane.OK_OPTION);
                        e.printStackTrace();
			System.exit( -1);
		}	
		return ret;
	}
	
	/**
	 * Writes the specified text into a file.
	 * @param filename
	 * The name of the file with path as a <i>String</i>.
	 * @param text
	 * The content of the file as a <i>String</i>.
	 */
	private void writeFile( String filename, String text){
            
		try{
			BufferedWriter out = new BufferedWriter(  new FileWriter(filename));
			out.write(text);
			out.close();
		}catch (Exception e){
			e.printStackTrace();
			System.exit( -1);
		}
	}
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnGo;
    private javax.swing.JButton btnOpenCppPath;
    private javax.swing.JButton btnOpenCppTemplate;
    private javax.swing.JButton btnOpenHPath;
    private javax.swing.JButton btnOpenHTemplate;
    private javax.swing.JButton btnOpenHppTemplate;
    private javax.swing.JLabel lblConfig;
    private javax.swing.JLabel lblLog;
    private javax.swing.JPanel pnlConfig;
    private javax.swing.JPanel pnlLog;
    private javax.swing.JScrollPane pnlScrollConfig;
    private javax.swing.JScrollPane pnlScrollLog;
    private javax.swing.JSplitPane pnlSplit;
    private javax.swing.JTextArea txtConfig;
    private javax.swing.JTextArea txtLog;
    // End of variables declaration//GEN-END:variables


}
